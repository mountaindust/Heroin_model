%File name: heroin_multistart_alphalinear_muAconstant_comparisons (i.e.
%with alpha piecewise, muA linear case)

%parameters for alpha linear, muA constant case
m=-0.0166568947289087;
beta_A=2.01339039713503e-05;
beta_P=1.07613488853937e-05;
theta_1=0.271953012780878;
epsilon=2.55879092337285;
mu=0.00710;  
mu_A=0.00884;
mu_H=0.0466;
gamma=0.00500069447307207;
theta_2=0.361860571741226;
sigma=0.100038203446277;
zeta=0.0974935199219447;
theta_3=19.9918788391698;
nu=0.000116349238936298;
omega=0.0000000001;
b=0.291928600613385;



pars=[m,beta_A,beta_P,theta_1,epsilon,mu,mu_A,mu_H,gamma,theta_2,sigma,zeta,theta_3,nu,omega,b];



% Final time N; will run from beginning of 2013 to beginning of 2019 where t=0 represents 2013
% and t=6 represents 2019, with spacing (N-0)/(25-1)=0.25 between the points to represent quarters of a year:
N = 6; 
%tspan=linspace(0,N,25);
% For smooth data plots; 73 marks to represent 72 months in 6 years 
tspan=linspace(0,N,73);


% Initial conditions
P0=0.0815718347996123;
A0=0.00762380594619159;
H0=0.000467529598012306;
R0=1.14233803732730e-05;
S0=1-P0-A0-H0-R0;
X0=0;
L0=0;
M0=0;
J0=0;
K0=0;
initials = [S0;P0;A0;H0;R0;X0;L0;M0;J0;K0];

% Run stiff ODE solver 
[t,y]=ode15s(@HeroinModel,tspan,initials,[],pars);

% Gives solution vector for each state 
  S=y(:,1);
  P=y(:,2);
  A=y(:,3);
  H=y(:,4);
  R=y(:,5);
  X=y(:,6);
  L=y(:,7);
  M=y(:,8);
  J=y(:,9);
  K=y(:,10);

 
  
  % Making sure S+P+A+H+R=1
 total=y(:,1)+y(:,2)+y(:,3)+y(:,4)+y(:,5);
 
Estim1=[y(1,2)+y(5,6)-y(1,6); y(5,2)+y(9,6)-y(5,6); y(9,2)+y(13,6)-y(9,6);...
         y(13,2)+y(17,6)-y(13,6); y(17,2)+y(21,6)-y(17,6); y(21,2)+y(25,6)-y(21,6)];
     
Estim2=[y(1,3)+y(5,7)-y(1,7); y(5,3)+y(9,7)-y(5,7); y(9,3)+y(13,7)-y(9,7);...
        y(13,3)+y(17,7)-y(13,7); y(17,3)+y(21,7)-y(17,7); y(21,3)+y(25,7)-y(21,7)];
    
Estim3=[y(5,4)+y(9,8)-y(5,8); y(9,4)+y(13,8)-y(9,8); y(13,4)+y(17,8)-y(13,8)];
     
Estim4=y(1:24,2)+y(2:25,6)-y(1:24,6);
      
Estim5=[y(5,9)-y(1,9); y(9,9)-y(5,9); y(13,9)-y(9,9); y(17,9)-y(13,9)];

Estim6=[y(5,10)-y(1,10); y(9,10)-y(5,10); y(13,10)-y(9,10);...
        y(17,10)-y(13,10); y(21,10)-y(17,10)];
 % Actual Data for years 2013-2018
Data1=[1825910./5519417; 1805325./5559702; 1800614./5602187; 1744766./5648259; 1620955./5702475; 1455093./5754509];
 
Data2=[43418./5519417; 42928./5559702; 42816./5602187; 37464./5648259; 34805./5702475; 31244./5754509];
  
Data3=[7560./5559702; 7560./5602187; 10260./5648259];
  
Data4=[847077./5519417; 860931./5519417; 864889./5519417; 847077./5519417;...
        833223./5559702; 851035./5559702; 861921./5559702; 841140./5559702;...
        827285./5602187; 852025./5602187; 855983./5602187; 845098./5602187;...
        832085./5648259; 821189./5648259; 793453./5648259; 775622./5648259;...
        775622./5702475; 764726./5702475; 739961./5702475; 706282./5702475;...
        688451./5754509; 683498./5754509; 641894./5754509; 625054./5754509];
    
Data5=[351./5519417; 360./5559702; 377./5602187; 381./5648259];
 
Data6=[112./5519417; 201./5559702; 344./5602187; 488./5648259; 702./5702475];

Diff1=Estim1-Data1;
Diff2=Estim2-Data2;
Diff3=Estim3-Data3;
Diff4=Estim4-Data4;
Diff5=Estim5-Data5;
Diff6=Estim6-Data6;

value=norm(Diff1,2)./norm(Data1)+norm(Diff2,2)./norm(Data2)+norm(Diff3,2)./norm(Data3)+norm(Diff4,2)./norm(Data4)+norm(Diff5,2)./norm(Data5)+norm(Diff6,2)./norm(Data6)

 
 %these are more refined Estim1-6 solutions (more points in between)
 %for the alpha linear, muA constant case 
 
 for i=1:61;
    continuous1(i)=y(i,2)+y(i+12,6)-y(i,6);
 end 
 
 for i=1:61;
    continuous2(i)=y(i,3)+y(i+12,7)-y(i,7);
 end 
 
 for i=1:25;
    continuous3(i)=y(i+12,4)+y(i+24,8)-y(i+12,8);
 end 
 
 for i=1:70;
    continuous4(i)=y(i,2)+y(i+3,6)-y(i,6);
 end 
 
 for i=1:37;
    continuous5(i)=y(i+12,9)-y(i,9);
 end 
 
 for i=1:49;
     continuous6(i)=y(i+12,10)-y(i,10);
 end 
 
 %these are the Estim1-6 solutions for alpha linear, muA linear case to
 %be able to compare to continuous1-6 plots (these vectors COME FROM the
 %continuous1-6 values in the
 %heroin_multistart_alphalinear_muAlinear_data_fits.m code
 
 linearlinear1=[0.335036343925646,0.337511546371846,0.339163627122150,0.340141093472816,0.340565616711216,0.340578195053904,0.340249973478594,0.339674332698466,0.338899497505324,0.337966057997573,0.336914632131352,0.335755853946409,0.334521287064758,0.333215223108802,0.331856619536116,0.330448412207839,0.329010608295516,0.327545099780661,0.326055213857882,0.324553733425900,0.323035613039944,0.321506218158195,0.319970933248819,0.318424574780061,0.316872410500782,0.315315671595490,0.313752923799430,0.312186374324336,0.310615155126935,0.309039043185514,0.307460106762462,0.305879077235882,0.304296685983877,0.302713664384551,0.301127279793960,0.299537686808298,0.297946664124680,0.296354543239551,0.294761655649360,0.293168335896827,0.291571876589276,0.289973215719290,0.288373009164809,0.286771312677238,0.285168182007982,0.283563690327379,0.281956858645596,0.280348224557710,0.278737801584541,0.277125570697331,0.275511512867319,0.273895637313646,0.272278155237464,0.270658869556548,0.269037811155352,0.267414977479756,0.265790365975640,0.264164037448771,0.262536140780579,0.260906559888050,0.259275276813800];
 linearlinear2=[0.00810008018402865,0.00805484699366658,0.00801052931500452,0.00796706906756166,0.00792437137242030,0.00788237447988679,0.00784102594304940,0.00780025061347796,0.00776001708298163,0.00772027468055450,0.00768097303356096,0.00764208853157044,0.00760357387633374,0.00756539547947859,0.00752752161943291,0.00748991843699084,0.00745255108324491,0.00741539087111058,0.00737840507701342,0.00734155936192211,0.00730482688698088,0.00726817626977683,0.00723158109264493,0.00719501745373934,0.00715845225445963,0.00712185755419918,0.00708520868578019,0.00704847650994042,0.00701164406946125,0.00697468702735982,0.00693757365632650,0.00690027762956692,0.00686277262028670,0.00682503230169147,0.00678705106753875,0.00674880268379984,0.00671025635794939,0.00667138793110884,0.00663217324439961,0.00659258926110162,0.00655264582659015,0.00651230862561796,0.00647155165920561,0.00643035376505068,0.00638869378085079,0.00634655783281765,0.00630397537202128,0.00626089635494241,0.00621730239485473,0.00617317610879537,0.00612850011380145,0.00608326078417813,0.00603747581025008,0.00599115651271426,0.00594425867878588,0.00589676993574501,0.00584867791087172,0.00579998324455597,0.00575070466652188,0.00570080648702771,0.00565030176132908];
 linearlinear3=[0.00103695487552090,0.00107038033984182,0.00110487605075861,0.00114046880093853,0.00117719904874764,0.00121510550120159,0.00125421008517383,0.00129454423877671,0.00133613820309699,0.00137902298110814,0.00142325967182250,0.00146888420300986,0.00151591781105187,0.00156439438941842,0.00161434688694804,0.00166580954301327,0.00171886128543898,0.00177352477647927,0.00182983016070838,0.00188781520706264,0.00194751768447840,0.00200897536189199,0.00207227424626288,0.00213742527419689,0.00220447031154578];
 linearlinear4=[0.147648323869776,0.151147846029140,0.153783533074622,0.155712003224081,0.157063506372416,0.157984435874507,0.158550180300426,0.158857305942234,0.158955865585645,0.158889416654374,0.158698319974413,0.158396049176332,0.158013855753712,0.157558172196203,0.157048416095950,0.156487710509629,0.155897526317130,0.155279150218283,0.154636327792687,0.153982406362862,0.153311610102799,0.152629813981261,0.151942725279049,0.151244969564129,0.150541878235882,0.149834607046264,0.149121658502315,0.148405384273303,0.147685371520406,0.146961344464182,0.146235359714278,0.145507942780801,0.144779837837899,0.144051937598014,0.143321769261586,0.142589420121643,0.141856716539935,0.141123621955290,0.140390607768716,0.139658104276233,0.138923394881538,0.138187447639525,0.137450932438125,0.136713697491820,0.135975918162634,0.135237654844795,0.134497884858967,0.133757174954883,0.133015536363567,0.132272969990572,0.131529437475509,0.130784944758210,0.130039703861390,0.129293562696967,0.128546535448060,0.127798660511590,0.127049903440320,0.126300327637628,0.125550084582553,0.124799060789694,0.124047268230735,0.123294714776497,0.122541364125215,0.121787259089539,0.121032403178508,0.120276736725757,0.119520313213950,0.118763138302076,0.118005217649120,0.117246529582609];
 linearlinear5=[6.34333061814849e-05,6.35725081995896e-05,6.37165420610117e-05,6.38641873834468e-05,6.40147235292391e-05,6.41670142210936e-05,6.43204481664292e-05,6.44744071346108e-05,6.46282679286201e-05,6.47816563127666e-05,6.49342083819813e-05,6.50854803408875e-05,6.52351903502151e-05,6.53831324924090e-05,6.55288326742223e-05,6.56722107612079e-05,6.58126235880238e-05,6.59497081392611e-05,6.60835457718088e-05,6.62138232476407e-05,6.63405325257052e-05,6.64634811841483e-05,6.65815765052751e-05,6.66947208003363e-05,6.68030093183898e-05,6.69062740933008e-05,6.70045135790326e-05,6.70974988701750e-05,6.71838470311088e-05,6.72639731713195e-05,6.73376816441237e-05,6.74047285090325e-05,6.74648698255574e-05,6.75178616532095e-05,6.75623185123696e-05,6.75991577675267e-05,6.76277565053375e-05];
 linearlinear6=[2.63040384641020e-05,2.71470093239018e-05,2.80182470306845e-05,2.89184351394042e-05,2.98480597543267e-05,3.08081600618246e-05,3.17997413272437e-05,3.28234114517150e-05,3.38806654697748e-05,3.49723309106164e-05,3.60991436358391e-05,3.72629427502320e-05,3.84643276365027e-05,3.97042856021320e-05,4.09846686838333e-05,4.23058851394937e-05,4.36707472630850e-05,4.50812603700691e-05,4.65369593186314e-05,4.80391296909494e-05,4.95880219084928e-05,5.11845452551574e-05,5.28344421525649e-05,5.45384205966366e-05,5.62958505808186e-05,5.81076323611575e-05,5.99738492978205e-05,6.18957007756470e-05,6.38810740912074e-05,6.59276284170810e-05,6.80363837349095e-05,7.02086943825602e-05,7.24459146979005e-05,7.47493990187975e-05,7.71277789817646e-05,7.95756197803455e-05,8.20963626144030e-05,8.46916680068884e-05,8.73631964807532e-05,9.01139684883843e-05,9.29482969426866e-05,9.58633417642187e-05,9.88625893575034e-05,0.000101947836122259,0.000105120878458204,0.000108388009272075,0.000111749662218801,0.000115205348954457,0.000118757200385201];
 
 %these are the Estim1-6 solutions for alpha piecewise, muA constant case to
 %be able to compare to continuous1-6 plots (these vectors COME FROM the
 %continuous1-6 values in the
 %heroin_multistart_alphapiecewise_muAconstant_data_fits.m code
 piecewiseconstant1=[0.335947941748198,0.336076181263093,0.336028731650077,0.335840057687588,0.335536665332430,0.335138683977527,0.334667246111909,0.334132820823745,0.333556641852326,0.332951160386255,0.332311533129403,0.331657606603576,0.330991621701331,0.330308437357359,0.329619679163996,0.328922760450589,0.328217215492977,0.327507721039725,0.326792614650211,0.326073237194444,0.325350610520813,0.324623185033774,0.323893366864910,0.323161933696836,0.322429663212165,0.321684497489004,0.320859595273466,0.319989534985642,0.319070397402148,0.318096341270561,0.317061525338457,0.315941158728790,0.314717407527713,0.313393207694555,0.311960290595043,0.310409782035761,0.308732807823293,0.306973913921474,0.305128197585812,0.303176589159309,0.301116976412509,0.298947247115954,0.296701117371746,0.294394436392642,0.292035937074119,0.289616244391599,0.287140815706075,0.284623932320127,0.282071283729779,0.279498164078263,0.276906659153440,0.274303999334446,0.271695388799639,0.269087585255241,0.266463194293677,0.263835047428059,0.261211224344500,0.258594614332223,0.255987771191033,0.253370352742405,0.250745541303496];
 piecewiseconstant2=[0.00814332816131773,0.00810899286091615,0.00807520143536094,0.00804193991680661,0.00800918970405765,0.00797692347178771,0.00794512403778121,0.00791376746999380,0.00788283206108986,0.00785230120748644,0.00782215137049544,0.00779236097257918,0.00776290956992350,0.00773377734195487,0.00770494632162393,0.00767640111997423,0.00764811898148927,0.00762007996675257,0.00759226522160203,0.00756465529910126,0.00753723569446547,0.00750998664124202,0.00748288801083278,0.00745592094191273,0.00742906657315684,0.00740229675709452,0.00737554514725103,0.00734881921401155,0.00732209545669376,0.00729535052002931,0.00726856104874986,0.00724165249490692,0.00721457779076530,0.00718733568422476,0.00715989543555111,0.00713222633876853,0.00710429768790120,0.00707605554446255,0.00704747996410715,0.00701853818663497,0.00698919745579719,0.00695942501534497,0.00692923849527788,0.00689859837470627,0.00686747220564058,0.00683583086525911,0.00680364763361974,0.00677094608028393,0.00673770080829606,0.00670389169215585,0.00666949277150863,0.00663448458424581,0.00659886778542204,0.00656263040956870,0.00652575898499379,0.00648823510825149,0.00645004249899951,0.00641116795426836,0.00637159858252327,0.00633132950052984,0.00629034688483215];
 piecewiseconstant3=[0.00103956480052607,0.00107256037934161,0.00110661060411460,0.00114176732463394,0.00117803873833814,0.00121545501763565,0.00125404521133075,0.00129383909594449,0.00133492464614708,0.00137731742316671,0.00142104330219785,0.00146613737645175,0.00151263473913968,0.00156058369093801,0.00161008432577679,0.00166113096661785,0.00171376749909606,0.00176803488727543,0.00182397409521997,0.00188167015296379,0.00194117644989564,0.00200251640295785,0.00206573809290155,0.00213088803626252,0.00219801274957655];
 piecewiseconstant4=[0.153865385480615,0.154426203526801,0.154802055820563,0.155029930252973,0.155137577866577,0.155146830243386,0.155080355600672,0.154948016198222,0.154772989407656,0.154568111891821,0.154327755734328,0.154072944111602,0.153805564280692,0.153520311215022,0.153229401877410,0.152930209242369,0.152622170717592,0.152310059326282,0.151992016784067,0.151669568308615,0.151344139748476,0.151014149212923,0.150682003669472,0.150348377660183,0.150013891781805,0.149679546473050,0.149344359460596,0.149006794115096,0.148669217161624,0.148331705175535,0.147994771027518,0.147658894457157,0.147321334257380,0.146983082806790,0.146632013360914,0.146202405960312,0.145730514675545,0.145214809815002,0.144672822456450,0.144085401483698,0.143429698682764,0.142692972985739,0.141879519612223,0.141008449013674,0.140085144688197,0.139091852413106,0.138074453272815,0.137010318874031,0.135899336104915,0.134754247895603,0.133572143218638,0.132391083969394,0.131205918405414,0.130018105420313,0.128808379752029,0.127588818787369,0.126375572027724,0.125172581669712,0.123982243415891,0.122784210467515,0.121582661495648,0.120383773907904,0.119188297623235,0.117998584403210,0.116807052100248,0.115611788724776,0.114415153888610,0.113215095813494,0.112011854846370,0.110804925742620];
 piecewiseconstant5=[6.55253081267069e-05,6.52109842655394e-05,6.49016782438892e-05,6.45973635294029e-05,6.42978276246480e-05,6.40030291162591e-05,6.37125879946806e-05,6.34262518760262e-05,6.31438395213025e-05,6.28647438406813e-05,6.25891059888346e-05,6.23166597965665e-05,6.20472960161889e-05,6.17809874145220e-05,6.15172100997049e-05,6.12555655201968e-05,6.09962923083358e-05,6.07391970771599e-05,6.04843000436407e-05,6.02314916256525e-05,5.99798525628551e-05,5.97298574101575e-05,5.94812725526309e-05,5.92339555500942e-05,5.89877639623667e-05,5.87423698650334e-05,5.84969880593637e-05,5.82524021687726e-05,5.80081126233398e-05,5.77639499939295e-05,5.75197448514056e-05,5.72745655708195e-05,5.70287023255358e-05,5.67821642750385e-05,5.65345946835535e-05,5.62857935338620e-05,5.60355608087456e-05];
 piecewiseconstant6=[2.66029874380297e-05,2.74422632410624e-05,2.83092734744449e-05,2.92042342104456e-05,3.01279171672427e-05,3.10811109831518e-05,3.20651546154531e-05,3.30804050349706e-05,3.41279343309439e-05,3.52113408692052e-05,3.63293989719061e-05,3.74832115948706e-05,3.86733531953742e-05,3.99001426969515e-05,4.11668461189638e-05,4.24767110776851e-05,4.38279706311084e-05,4.52217424728470e-05,4.66581725322497e-05,4.81380361143539e-05,4.96690972019163e-05,5.12478641122966e-05,5.28758642771237e-05,5.45542652947061e-05,5.62842347633527e-05,5.80686106200444e-05,5.99147656039047e-05,6.18160734702142e-05,6.37765572261772e-05,6.57977131188621e-05,6.78810373953370e-05,7.00344138063559e-05,7.22552816249897e-05,7.45436784797324e-05,7.69026898675254e-05,7.93340484524564e-05,8.18394868986137e-05,8.44307423466448e-05,8.70962673919755e-05,8.98431710287540e-05,9.26734523249686e-05,9.55891103486078e-05,9.86020801803573e-05,0.000101705817237391,0.000104899017114604,0.000108187512844863,0.000111573456205683,0.000115067919233234,0.000118673288373914];
 
 
 %these are the Estim1-6 solutions for alpha piecewise, muA linear case to
 %be able to compare to continuous1-6 plots (these vectors COME FROM the
 %continuous1-6 values in the
 %heroin_multistart_alphapiecewise_muAlinear_data_fits.m code
 piecewiselinear1=[0.333601728399227,0.333175915483808,0.332728321407081,0.332261709006972,0.331780106556135,0.331285822903598,0.330781805718608,0.330270243323109,0.329752542479767,0.329234185659181,0.328712747924094,0.328186832641041,0.327656427978364,0.327121471723743,0.326586343618708,0.326051779683797,0.325515258078936,0.324976778804124,0.324436161331332,0.323894939641381,0.323354987516237,0.322814340991552,0.322272988827463,0.321730919784106,0.321188343663517,0.320589637051673,0.319939210399238,0.319245188880588,0.318501689710403,0.317702830103363,0.316836163635227,0.315846061713639,0.314753472916051,0.313548164931580,0.312219905449344,0.310758462158459,0.309166356568282,0.307475419903405,0.305677177199966,0.303768676095526,0.301752121333991,0.299626275354035,0.297397599721574,0.295118252226201,0.292765158692456,0.290344669208159,0.287865048100999,0.285333968692635,0.282785076012579,0.280228764371165,0.277640818987627,0.275021803620529,0.272372181989138,0.269720261939558,0.267082564225601,0.264434879447237,0.261776468070373,0.259106558128211,0.256435796049093,0.253770992362617,0.251103097887795];
 piecewiselinear2=[0.00809714168615252,0.00805057973988540,0.00800482150852405,0.00795983904182614,0.00791569162814685,0.00787236148442237,0.00782983069567537,0.00778798352559018,0.00774668914236077,0.00770595670642028,0.00766583177338046,0.00762634058082401,0.00758744371978373,0.00754893397305952,0.00751083953935850,0.00747313815723299,0.00743590610147142,0.00739914337207379,0.00736267577740545,0.00732649171262156,0.00729047382815929,0.00725471731508819,0.00721920608533321,0.00718392405081931,0.00714882372579705,0.00711367426551655,0.00707859108475582,0.00704356521282507,0.00700857542547382,0.00697360049845156,0.00693850158188103,0.00690319956770943,0.00686771669309500,0.00683201221024708,0.00679604537137500,0.00675977542868812,0.00672306352766428,0.00668588881302380,0.00664832246457599,0.00661035028308593,0.00657196335354125,0.00653299274776481,0.00649334262549700,0.00645317318807437,0.00641245674418663,0.00637118745783799,0.00632925096247715,0.00628656639948137,0.00624325172497510,0.00619932094031522,0.00615475741009546,0.00610947997533911,0.00606342187877861,0.00601668184885476,0.00596926962755058,0.00592117093903056,0.00587233393944851,0.00582270451131562,0.00577236951205417,0.00572135050278625,0.00566961883515297];
 piecewiselinear3=[0.00103648221384980,0.00107002455559030,0.00110458603756421,0.00114016260900581,0.00117676814912476,0.00121440265792105,0.00125345156247357,0.00129373094740695,0.00133523604175588,0.00137802594941656,0.00142213383531872,0.00146759286439210,0.00151442643833486,0.00156269159662780,0.00161245390926368,0.00166373576261723,0.00171657809983273,0.00177102186405450,0.00182706283366844,0.00188482567391737,0.00194431605587443,0.00200557577826225,0.00206864663980344,0.00213357043922064,0.00220053740736959];
 piecewiselinear4=[0.155076191543844,0.154944767134601,0.154790572135144,0.154616487508320,0.154426942963866,0.154224352146962,0.154012168655031,0.153792285735652,0.153565882568073,0.153338548968647,0.153107860000117,0.152872758089242,0.152633300844241,0.152389290881063,0.152145060138647,0.151901344637531,0.151655701778615,0.151408234836889,0.151158836466601,0.150908948138783,0.150660448526742,0.150411373074332,0.150161659569235,0.149911355814042,0.149660682850652,0.149410802944591,0.149160823036355,0.148910562597915,0.148660114139058,0.148409472768446,0.148158661330400,0.147907797470448,0.147656914416299,0.147406044030684,0.147098443736653,0.146739460146971,0.146337261538609,0.145906910046768,0.145440609334673,0.144922926531459,0.144300308903285,0.143595865303935,0.142807751366255,0.141974963403193,0.141064151825807,0.140084145128680,0.139052179703703,0.137968044226293,0.136867141912649,0.135759867073107,0.134618562621669,0.133441259077928,0.132230842505049,0.131016188273953,0.129813817138450,0.128601433938379,0.127380361907575,0.126148842859350,0.124916729162127,0.123690831345500,0.122462663987046,0.121232690806031,0.120000344277639,0.118768017219373,0.117537677841835,0.116306177807936,0.115072745150877,0.113838173930581,0.112603055836636,0.111368008507527];
 piecewiselinear5=[6.34945898043319e-05,6.36319293649670e-05,6.37705045675854e-05,6.39101042922182e-05,6.40503872193195e-05,6.41912249421352e-05,6.43324573385291e-05,6.44737038163033e-05,6.46145574546938e-05,6.47551056752634e-05,6.48954643897930e-05,6.50357003572356e-05,6.51755027366857e-05,6.53132370884030e-05,6.54499566245764e-05,6.55856269128759e-05,6.57203659293981e-05,6.58541736741431e-05,6.59840422264210e-05,6.61116918698183e-05,6.62373507637732e-05,6.63604649530502e-05,6.64808258657394e-05,6.65982249299312e-05,6.67127644146214e-05,6.68242401675997e-05,6.69313403379704e-05,6.70340899539851e-05,6.71321118689878e-05,6.72250289363227e-05,6.73151843786824e-05,6.73985620127609e-05,6.74760562826899e-05,6.75473071679625e-05,6.76119546480716e-05,6.76696387025106e-05,6.77163664109258e-05];
 piecewiselinear6=[2.63770784501621e-05,2.72171725816141e-05,2.80962751557056e-05,2.90157423083189e-05,2.99612075971519e-05,3.09307091152752e-05,3.19221180796356e-05,3.29492007698966e-05,3.40320569560434e-05,3.51330345182443e-05,3.62581791598768e-05,3.74109728809894e-05,3.85998050600412e-05,3.98687880815699e-05,4.11635405470877e-05,4.24805817026176e-05,4.38318377165285e-05,4.52173085888203e-05,4.66826993809339e-05,4.81917434168724e-05,4.97253088044604e-05,5.13095403229643e-05,5.29482938399488e-05,5.46454252229785e-05,5.63964009611590e-05,5.81721237924480e-05,6.00092999430002e-05,6.19101860339372e-05,6.38797920097807e-05,6.59231278150523e-05,6.80009250244965e-05,7.01487918321322e-05,7.23636340043446e-05,7.46475554800166e-05,7.70026601980311e-05,7.94310520972710e-05,8.19578456708497e-05,8.45758078674556e-05,8.72626591700114e-05,9.00161429573951e-05,9.28312492850853e-05,9.57535668134848e-05,9.88056083906411e-05,0.000101929156791526,0.000105124994469912,0.000108387161619352,0.000111762766473875,0.000115282532940518,0.000118868748845218];
 

 figure(1)
 hold all
 z1 = linspace(0,60,6); %defines mesh where going to plot Estim1, Data1 values 
 z7 = linspace(0,60,61);
 plot(z7,continuous1,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z7,linearlinear1,'k-','LineWidth',1.3);
 plot(z7,piecewiseconstant1,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z7,piecewiselinear1,'r','LineWidth',1.3);
 %scatter(z1, Estim1, 100, 'o');
 scatter(z1, Data1, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Year')
 ylabel('Proportion in P')
 legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14)
 set(gca, 'xtick', [ 0 12 24 36 48 60])
 set(gca,'XLim',[0 60])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016', '2017', '2018'})
 

 
 % Data points from proportion that is in A at some point in the year and corresponding ODE solution points 
 figure(2)
 hold all
 z2 = linspace(0,60,6);
 z8 = linspace(0,60,61);
 plot(z8,continuous2,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z8,linearlinear2,'k-','LineWidth',1.3);
 plot(z8,piecewiseconstant2,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z8,piecewiselinear2,'r-','LineWidth',1.3);
 %scatter(z2, Estim2, 100, 'o');
 scatter(z2, Data2, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Year')
 ylabel('Proportion in A')
 legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14)
 set(gca, 'xtick', [ 0 12 24 36 48 60])
 set(gca,'XLim',[0 60])
 set(gca,'xticklabel',{'2013','2014','2015','2016','2017','2018'})




 % Data points from proportion that is in H at some point in the year and corresponding ODE solution points 
 figure(3)
 hold all
 z3 = linspace(0,24,3);
 z9 = linspace(0,24,25);
 plot(z9,continuous3,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z9,linearlinear3,'k-','LineWidth',1.3);
 plot(z9,piecewiseconstant3,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z9,piecewiselinear3,'r-','LineWidth',1.3);
 %scatter(z3, Estim3, 100,'o');
 scatter(z3, Data3, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Year')
 ylabel('Proportion in H')
 legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14, 'Location','northwest')
 set(gca, 'xtick', [ 0 12 24])
 set(gca,'XLim',[0 24])
 set(gca,'xticklabel',{'2014', '2015', '2016'})
 

 % Data points from proportion that is in P at some point in the quarter of a year and corresponding ODE solution points 
 figure(4)
 hold all
 z4 = linspace(0,69,24);
 z10 = linspace(0,69,70);
 plot(z10,continuous4,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z10,linearlinear4,'k-','LineWidth',1.3);
 plot(z10,piecewiseconstant4,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z10,piecewiselinear4,'r-','LineWidth',1.3);
 %scatter(z4, Estim4, 100, 'o');
 scatter(z4, Data4, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Quarter')
 ylabel('Proportion in P')
 legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14, 'Location','southwest')
 %legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant' '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14)
 set(gca, 'xtick', [ 0 3 6 9 12 15 18 21 24 27 30 33 36 39 42 45 48 51 54 57 60 63 66 69])
 xtickangle(90)
 set(gca,'XLim',[0 69])
 set(gca,'xticklabel',{'Q1 2013', 'Q2 2013', 'Q3 2013', 'Q4 2013',...
                       'Q1 2014', 'Q2 2014', 'Q3 2014', 'Q4 2014',...
                       'Q1 2015', 'Q2 2015', 'Q3 2015', 'Q4 2015',...
                       'Q1 2016', 'Q2 2016', 'Q3 2016', 'Q4 2016',...
                       'Q1 2017', 'Q2 2017', 'Q3 2017', 'Q4 2017',...
                       'Q1 2018', 'Q2 2018', 'Q3 2018', 'Q4 2018'})
 
  
 figure(5)
 hold all
 z5 = linspace(0,36,4); %defines mesh where going to plot Estim5, Data5 values
 z11 = linspace(0,36,37);
 plot(z11,continuous5,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z11,linearlinear5,'k-','LineWidth',1.3);
 plot(z11,piecewiseconstant5,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z11,piecewiselinear5,'r-','LineWidth',1.3);
 %scatter(z5, Estim5, 100,'o');
 scatter(z5, Data5, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Year')
 ylabel('Proportion overdose from A') % at some point during the year
 legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14, 'Location','southwest')
 set(gca, 'xtick', [ 0 12 24 36])
 set(gca,'XLim',[0 36])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016'})
 
 
 figure(6)
 hold all
 z6 = linspace(0,48,5);
 z12 = linspace(0,48,49);
 plot(z12,continuous6,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z12,linearlinear6,'k-','LineWidth',1.3);
 plot(z12,piecewiseconstant6,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z12,piecewiselinear6,'r-','LineWidth',1.3);
 %scatter(z6, Estim6, 100,'o');
 scatter(z6, Data6, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Year')
 ylabel('Proportion overdose from H') % at some point during the year
 legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14, 'Location','northwest')
 set(gca, 'xtick', [ 0 12 24 36 48])
 set(gca,'XLim',[0 48])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016', '2017'})  
 

 
  
 figure(7)
 hold all
 z1 = linspace(0,60,6); %defines mesh where going to plot Estim1, Data1 values 
 z7 = linspace(0,60,61);
 plot(z7,continuous1,'k-','LineWidth',1.3);
 %scatter(z1, Estim1, 100, 'o');
 scatter(z1, Data1, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Year')
 ylabel('Proportion in P')
 legend({'\alpha linear, \mu_A constant','Data'},'FontSize', 14)
 set(gca, 'xtick', [ 0 12 24 36 48 60])
 set(gca,'XLim',[0 60])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016', '2017', '2018'})
 
 
 % Data points from proportion that is in P at some point in the quarter of a year and corresponding ODE solution points 
 figure(8)
 hold all
 z4 = linspace(0,69,24);
 z10 = linspace(0,69,70);
 plot(z10,continuous4,'k-','LineWidth',1.3);
 %scatter(z4, Estim4, 100, 'o');
 scatter(z4, Data4, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',16)
 xlabel('Quarter')
 ylabel('Proportion in P')
 legend({'\alpha linear, \mu_A constant','Data'},'FontSize', 14)
 set(gca, 'xtick', [ 0 3 6 9 12 15 18 21 24 27 30 33 36 39 42 45 48 51 54 57 60 63 66 69])
 xtickangle(90)
 set(gca,'XLim',[0 69])
 set(gca,'xticklabel',{'Q1 2013', 'Q2 2013', 'Q3 2013', 'Q4 2013',...
                       'Q1 2014', 'Q2 2014', 'Q3 2014', 'Q4 2014',...
                       'Q1 2015', 'Q2 2015', 'Q3 2015', 'Q4 2015',...
                       'Q1 2016', 'Q2 2016', 'Q3 2016', 'Q4 2016',...
                       'Q1 2017', 'Q2 2017', 'Q3 2017', 'Q4 2017',...
                       'Q1 2018', 'Q2 2018', 'Q3 2018', 'Q4 2018'})
 
  

figure(9)
 hold all
 z1 = linspace(0,60,6); %defines mesh where going to plot Estim1, Data1 values 
 z7 = linspace(0,60,61);
 %plot(z7,continuous1,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z7,linearlinear1,'k-','LineWidth',1.3);
 %plot(z7,piecewiseconstant1,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z7,piecewiselinear1,'r','LineWidth',1.3);
 %scatter(z1, Estim1, 100, 'o');
 scatter(z1, Data1, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',18)
 xlabel('Year')
 ylabel('Proportion in P')
 legend({ '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 18)
 set(gca, 'xtick', [ 0 12 24 36 48 60])
 set(gca,'XLim',[0 60])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016', '2017', '2018'})
 

 
 % Data points from proportion that is in A at some point in the year and corresponding ODE solution points 
 figure(10)
 hold all
 z2 = linspace(0,60,6);
 z8 = linspace(0,60,61);
 %plot(z8,continuous2,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z8,linearlinear2,'k-','LineWidth',1.3);
 %plot(z8,piecewiseconstant2,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z8,piecewiselinear2,'r-','LineWidth',1.3);
 %scatter(z2, Estim2, 100, 'o');
 scatter(z2, Data2, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',18)
 xlabel('Year')
 ylabel('Proportion in A')
 legend({'\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 18)
 set(gca, 'xtick', [ 0 12 24 36 48 60])
 set(gca,'XLim',[0 60])
 set(gca,'xticklabel',{'2013','2014','2015','2016','2017','2018'})




 % Data points from proportion that is in H at some point in the year and corresponding ODE solution points 
 figure(11)
 hold all
 z3 = linspace(0,24,3);
 z9 = linspace(0,24,25);
 %plot(z9,continuous3,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z9,linearlinear3,'k-','LineWidth',1.3);
 %plot(z9,piecewiseconstant3,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z9,piecewiselinear3,'r-','LineWidth',1.3);
 %scatter(z3, Estim3, 100,'o');
 scatter(z3, Data3, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',18)
 xlabel('Year')
 ylabel('Proportion in H')
 legend({'\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 18, 'Location','northwest')
 set(gca, 'xtick', [ 0 12 24])
 set(gca,'XLim',[0 24])
 set(gca,'xticklabel',{'2014', '2015', '2016'})
 

 % Data points from proportion that is in P at some point in the quarter of a year and corresponding ODE solution points 
 figure(12)
 hold all
 z4 = linspace(0,69,24);
 z10 = linspace(0,69,70);
 %plot(z10,continuous4,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z10,linearlinear4,'k-','LineWidth',1.3);
 %plot(z10,piecewiseconstant4,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z10,piecewiselinear4,'r-','LineWidth',1.3);
 %scatter(z4, Estim4, 100, 'o');
 scatter(z4, Data4, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',18)
 xlabel('Quarter')
 ylabel('Proportion in P')
 legend({'\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 18, 'Location','southwest')
 %legend({'\alpha linear, \mu_A constant', '\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A constant' '\alpha pw linear, \mu_A linear','Data'},'FontSize', 14)
 set(gca, 'xtick', [ 0 3 6 9 12 15 18 21 24 27 30 33 36 39 42 45 48 51 54 57 60 63 66 69])
 xtickangle(90)
 set(gca,'XLim',[0 69])
 set(gca,'xticklabel',{'Q1 2013', 'Q2 2013', 'Q3 2013', 'Q4 2013',...
                       'Q1 2014', 'Q2 2014', 'Q3 2014', 'Q4 2014',...
                       'Q1 2015', 'Q2 2015', 'Q3 2015', 'Q4 2015',...
                       'Q1 2016', 'Q2 2016', 'Q3 2016', 'Q4 2016',...
                       'Q1 2017', 'Q2 2017', 'Q3 2017', 'Q4 2017',...
                       'Q1 2018', 'Q2 2018', 'Q3 2018', 'Q4 2018'})
 
  
 figure(13)
 hold all
 z5 = linspace(0,36,4); %defines mesh where going to plot Estim5, Data5 values
 z11 = linspace(0,36,37);
 %plot(z11,continuous5,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z11,linearlinear5,'k-','LineWidth',1.3);
 %plot(z11,piecewiseconstant5,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z11,piecewiselinear5,'r-','LineWidth',1.3);
 %scatter(z5, Estim5, 100,'o');
 scatter(z5, Data5, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',18)
 xlabel('Year')
 ylabel('Proportion overdose from A') % at some point during the year
 legend({'\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 18, 'Location','southwest')
 set(gca, 'xtick', [ 0 12 24 36])
 set(gca,'XLim',[0 36])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016'})
 
 
 figure(14)
 hold all
 z6 = linspace(0,48,5);
 z12 = linspace(0,48,49);
 %plot(z12,continuous6,'color',[0.138,1,0.226],'LineWidth',1.3);
 plot(z12,linearlinear6,'k-','LineWidth',1.3);
 %plot(z12,piecewiseconstant6,'color',[.7, 0, 0.5],'LineWidth',1.3);
 plot(z12,piecewiselinear6,'r-','LineWidth',1.3);
 %scatter(z6, Estim6, 100,'o');
 scatter(z6, Data6, 90,'o','MarkerFaceColor',[0.01 0.28 1], 'MarkerEdgeColor',[0.01 0.28 1]);
 set(gca, 'fontsize',18)
 xlabel('Year')
 ylabel('Proportion overdose from H') % at some point during the year
 legend({'\alpha linear, \mu_A linear', '\alpha pw linear, \mu_A linear','Data'},'FontSize', 18, 'Location','northwest')
 set(gca, 'xtick', [ 0 12 24 36 48])
 set(gca,'XLim',[0 48])
 set(gca,'xticklabel',{'2013', '2014', '2015', '2016', '2017'})  
 
         
function alpha = a(t,pars)
alpha = pars(1)*t+pars(16);
end


function f = HeroinModel(t,y,pars)
f=zeros(10,1);
f(1)=-a(t,pars)*y(1)-pars(2)*y(1)*y(3)-pars(3)*y(1)*y(2)-pars(4)*y(1)*y(4)+pars(5)*y(2)+pars(6)*(y(2)+y(5))+(pars(6)+pars(7))*y(3)+(pars(6)+pars(8))*y(4);
f(2)=a(t,pars)*y(1)-pars(5)*y(2)-pars(9)*y(2)-pars(10)*y(2)*y(4)-pars(6)*y(2);
f(3)=pars(9)*y(2)+(pars(11)*y(5)*y(3))/(y(3)+y(4)+pars(15))+pars(2)*y(1)*y(3)+pars(3)*y(1)*y(2)-pars(12)*y(3)-pars(13)*y(3)*y(4)-pars(6)*y(3)-pars(7)*y(3);
f(4)=pars(4)*y(1)*y(4)+pars(10)*y(2)*y(4)+pars(13)*y(3)*y(4)+(pars(11)*y(5)*y(4))/(y(3)+y(4)+pars(15))-pars(14)*y(4)-(pars(6)+pars(8))*y(4);
f(5)=pars(12)*y(3)+pars(14)*y(4)-(pars(11)*y(5)*y(3))/(y(3)+y(4)+pars(15))-(pars(11)*y(5)*y(4))/(y(3)+y(4)+pars(15))-pars(6)*y(5);

% X' ODE to calculate the number of new cases of prescription opioid use over time;
% i.e. individuals who enter the P class at any time from S (used in
                                                             % Estim1, Estim4)
f(6) = a(t,pars)*y(1);

% L' ODE to calculate the number of new cases of opioid addiction over time;
% i.e. individuals who enter the A class at any time (used in Estim2)
f(7) = pars(9)*y(2)+(pars(11)*y(5)*y(3))/(y(3)+y(4)+pars(15))+pars(2)*y(1)*y(3)+pars(3)*y(1)*y(2);

% M' ODE to calculate the number of new cases of heroin/fentanyl addiction over time;
% i.e. individuals who enter the H class at any time (used in Estim3)
f(8) = pars(4)*y(1)*y(4)+pars(10)*y(2)*y(4)+pars(13)*y(3)*y(4)+(pars(11)*y(5)*y(4))/(y(3)+y(4)+pars(15));

%J' ODE to calculate number of prescription opioid addict overdoses over
%time; i.e. individuals who overdose at any time (used in Estim5)
f(9) = pars(7)*y(3);

%K' ODE to calculate number of heroin/fentanayl addict overdoses over
%time; i.e. individuals who overdose at any time (used in Estim6)
f(10) = pars(8)*y(4);
end



